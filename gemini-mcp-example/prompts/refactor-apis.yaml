id: refactor-apis
model: gemini-pro
temperature: 0.1
input_vars: ["code", "structure"]
prompt: |
  μ‹λ‹μ–΄ λ°±μ—”λ“ μ•„ν‚¤ν…νΈλ΅μ„ λ‹¤μ API κ΄€λ ¨ μ½”λ“λ¥Ό ν™•μ¥μ„±, μ•μ •μ„±, μ„±λ¥μ— μ¤‘μ μ„ λ‘κ³  λ¦¬ν©ν† λ§ν•μ„Έμ”.

  μ›λ³Έ μ½”λ“:
  ```typescript
  {{code}}
  ```

  ## π” API λ¦¬ν©ν† λ§ ν•µμ‹¬ μ›μΉ™:

  ### 1. κ°•λ ¥ν• μ—λ¬ μ²λ¦¬:
  - β… HTTP μƒνƒ μ½”λ“λ³„ μ„Έλ¶„ν™”λ μ—λ¬ μ²λ¦¬
  - β… λ„¤νΈμ›ν¬ μ—λ¬, νƒ€μ„μ•„μ›ƒ, νμ‹± μ—λ¬ κµ¬λ¶„
  - β… μ¬μ‹λ„ λ΅μ§ κµ¬ν„ (μ§€μ λ°±μ¤ν”„)
  - β… μ‚¬μ©μ μΉν™”μ  μ—λ¬ λ©”μ‹μ§€ μ κ³µ

  ### 2. νƒ€μ… μ•μ „μ„± κ°•ν™”:
  - β… μ”μ²­/μ‘λ‹µ νƒ€μ… μ—„κ²©ν μ •μ
  - β… λ°νƒ€μ„ μ‘λ‹µ κ²€μ¦ (Zod, Yup λ“±)
  - β… μ λ„¤λ¦­μ„ ν™μ©ν• μ¬μ‚¬μ© κ°€λ¥ν• API ν΄λΌμ΄μ–ΈνΈ
  - β… μ—λ¬ νƒ€μ… λ…μ‹μ  μ •μ

  ### 3. μ„±λ¥ μµμ ν™”:
  - β… μ”μ²­ μΊμ‹± μ „λµ κµ¬ν„
  - β… μ”μ²­ μ¤‘λ³µ μ κ±° (Request Deduplication)
  - β… μ‘λ‹µ μ••μ¶• ν™μ©
  - β… μ μ ν• νƒ€μ„μ•„μ›ƒ μ„¤μ •

  ### 4. λ³΄μ• κ°•ν™”:
  - β… μΈμ¦ ν† ν° μλ™ κ΄€λ¦¬
  - β… CSRF λ³΄νΈ κµ¬ν„
  - β… λ―Όκ°ν• λ°μ΄ν„° λ΅κΉ… λ°©μ§€
  - β… Rate Limiting λ€μ‘

  ### 5. ν™•μ¥μ„± λ° μ μ§€λ³΄μμ„±:
  - β… μΈν„°μ…‰ν„° ν¨ν„΄μΌλ΅ κ³µν†µ λ΅μ§ λ¶„λ¦¬
  - β… ν™κ²½λ³„ μ„¤μ • κ΄€λ¦¬
  - β… API λ²„μ „ κ΄€λ¦¬ μ§€μ›
  - β… λ¨λ‹ν„°λ§ λ° λ΅κΉ… ν†µν•©

  ## π”§ κµ¬μ²΄μ μΈ κ°μ„  ν¨ν„΄:

  ```typescript
  // β… API μ‘λ‹µ νƒ€μ…
  interface ApiResponse<T> {
    data: T;
    status: number;
    message?: string;
    timestamp: string;
  }

  // β… μ—λ¬ νƒ€μ… μ •μ
  class ApiError extends Error {
    constructor(
      message: string,
      public status: number,
      public code?: string
    ) {
      super(message);
      this.name = 'ApiError';
    }
  }

  // β… μ¬μ‹λ„ λ΅μ§
  const withRetry = async <T>(
    fn: () => Promise<T>,
    maxRetries = 3,
    baseDelay = 1000
  ): Promise<T> => {
    for (let attempt = 1; attempt <= maxRetries; attempt++) {
      try {
        return await fn();
      } catch (error) {
        if (attempt === maxRetries) throw error;
        const delay = baseDelay * Math.pow(2, attempt - 1);
        await new Promise(resolve => setTimeout(resolve, delay));
      }
    }
    throw new Error('Max retries exceeded');
  };

  // β… μ”μ²­ μ¤‘λ³µ μ κ±°
  const requestCache = new Map<string, Promise<any>>();
  const dedupedRequest = <T>(key: string, requestFn: () => Promise<T>): Promise<T> => {
    if (requestCache.has(key)) {
      return requestCache.get(key)!;
    }
    const promise = requestFn().finally(() => requestCache.delete(key));
    requestCache.set(key, promise);
    return promise;
  };
  ```

  ## π“‹ μ¶λ ¥ ν•μ‹:

  ---
  ## π“„ νμΌ: `κ°μ„ λ_νμΌλ….ts`
  ```typescript
  [λ¦¬ν©ν† λ§λ API μ½”λ“]
  [μ—λ¬ μ²λ¦¬, νƒ€μ… μ•μ „μ„±, μ„±λ¥ μµμ ν™” μ μ©]
  [μΈν„°μ…‰ν„°, μΊμ‹±, μ¬μ‹λ„ λ΅μ§ ν¬ν•¨]
  [JSDoc λ¬Έμ„ν™” ν¬ν•¨]
  ```

  ---

  **μ¤‘μ” κ·μΉ™:**
  - μ„¤λ… μ—†μ΄ μ‹¤ν–‰ κ°€λ¥ν• μ½”λ“λ§ μ¶λ ¥
  - λ¨λ“  API ν•¨μμ— JSDoc λ¬Έμ„ν™” μ¶”κ°€
  - μ—λ¬ μ²λ¦¬λ¥Ό μµμ°μ„ μΌλ΅ κ³ λ ¤
  - μ‹¤μ  ν”„λ΅λ•μ… ν™κ²½μ—μ„ μ‚¬μ© κ°€λ¥ν• μμ¤€
  - μ„±λ¥κ³Ό λ³΄μ•μ„ λ™μ‹μ— κ³ λ ¤

  μ§€κΈ λ°”λ΅ μ„ ν•μ‹μΌλ΅ λ¦¬ν©ν† λ§λ μ½”λ“λ¥Ό μ¶λ ¥ν•μ„Έμ”:
