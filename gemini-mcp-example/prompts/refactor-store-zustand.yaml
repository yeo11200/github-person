id: refactor-store-zustand
model: gemini-pro
temperature: 0.1
input_vars: ["code", "structure"]
prompt: |
  ì‹œë‹ˆì–´ í”„ë¡ íŠ¸ì—”ë“œ ì•„í‚¤í…íŠ¸ë¡œì„œ ë‹¤ìŒ Zustand ìƒíƒœ ê´€ë¦¬ ì½”ë“œë¥¼ ì„±ëŠ¥, ì˜ˆì¸¡ ê°€ëŠ¥ì„±, í™•ì¥ì„±ì— ì¤‘ì ì„ ë‘ê³  ë¦¬íŒ©í† ë§í•˜ì„¸ìš”.

  ì›ë³¸ ì½”ë“œ:
  ```typescript
  {{code}}
  ```

  í”„ë¡œì íŠ¸ êµ¬ì¡°:
  ```
  {{structure}}
  ```

  ## ğŸ“ Import ê²½ë¡œ ê·œì¹™:
  - âœ… **ì ˆëŒ€ê²½ë¡œ ìš°ì„ **: tsconfigì— `@/*` ë˜ëŠ” ì ˆëŒ€ê²½ë¡œ ì„¤ì •ì´ ìˆìœ¼ë©´ ë°˜ë“œì‹œ ì ˆëŒ€ê²½ë¡œ ì‚¬ìš©
  - âœ… **ì¼ê´€ì„± ìœ ì§€**: ê¸°ì¡´ ì½”ë“œì˜ import íŒ¨í„´ ë¶„ì„ í›„ ë™ì¼í•œ ë°©ì‹ ì ìš©
  - âœ… **ì˜ˆì‹œ**: `import { ApiService } from '@/services/api'` (ì ˆëŒ€ê²½ë¡œ ì„¤ì •ì‹œ)
  - âœ… **ì˜ˆì‹œ**: `import { User } from '@/types/user'` (ì ˆëŒ€ê²½ë¡œ ì„¤ì •ì‹œ)

  ## ğŸ» Zustand 5.0+ ë¦¬íŒ©í† ë§ í•µì‹¬ ì›ì¹™:

  ### 1. Store êµ¬ì¡° ìµœì í™”:
  - âœ… ìŠ¬ë¼ì´ìŠ¤ íŒ¨í„´ìœ¼ë¡œ ê´€ì‹¬ì‚¬ ë¶„ë¦¬
  - âœ… íƒ€ì… ì•ˆì „í•œ ìƒíƒœ ì •ì˜
  - âœ… ì•¡ì…˜ê³¼ ìƒíƒœ ëª…í™•íˆ ë¶„ë¦¬
  - âœ… ë¯¸ë“¤ì›¨ì–´ í™œìš©í•œ ê¸°ëŠ¥ í™•ì¥

  ### 2. ì„±ëŠ¥ ìµœì í™” (Zustand 5.0+):
  - âœ… useShallow í›…ìœ¼ë¡œ ì„ íƒì  êµ¬ë…
  - âœ… ë¶ˆí•„ìš”í•œ ë¦¬ë Œë”ë§ ë°©ì§€
  - âœ… ê³„ì‚°ëœ ê°’ ë©”ëª¨ì´ì œì´ì…˜
  - âœ… ì•¡ì…˜ í•¨ìˆ˜ ì•ˆì •í™”

  ### 3. ë¹„ë™ê¸° ì²˜ë¦¬ íŒ¨í„´:
  - âœ… ë¡œë”©/ì—ëŸ¬/ì„±ê³µ ìƒíƒœ í‘œì¤€í™”
  - âœ… ë‚™ê´€ì  ì—…ë°ì´íŠ¸ êµ¬í˜„
  - âœ… ìš”ì²­ ì·¨ì†Œ ë° ì •ë¦¬
  - âœ… ì¬ì‹œë„ ë¡œì§ ë‚´ì¥

  ### 4. íƒ€ì… ì•ˆì „ì„±:
  - âœ… ì—„ê²©í•œ TypeScript íƒ€ì… ì •ì˜
  - âœ… ì•¡ì…˜ í•¨ìˆ˜ íƒ€ì… ì•ˆì „ì„±
  - âœ… ì…€ë ‰í„° íƒ€ì… ì¶”ë¡ 
  - âœ… ë¯¸ë“¤ì›¨ì–´ íƒ€ì… ì§€ì›

  ## ğŸ”§ Zustand 5.0+ ê°œì„  íŒ¨í„´:

  ```typescript
  // âœ… ì ˆëŒ€ê²½ë¡œ ì‚¬ìš© (tsconfig ì„¤ì •ì‹œ)
  import { create, StateCreator } from 'zustand';
  import { devtools, persist, createJSONStorage } from 'zustand/middleware';
  import { immer } from 'zustand/middleware/immer';
  import { useShallow } from 'zustand/react/shallow';
  import { ApiService } from '@/services/api';
  import { User } from '@/types/user';

  // âœ… íƒ€ì… ì•ˆì „í•œ ìƒíƒœ ì •ì˜
  interface UserState {
    users: User[];
    currentUser: User | null;
    loading: boolean;
    error: string | null;
  }

  interface UserActions {
    fetchUsers: () => Promise<void>;
    setCurrentUser: (user: User) => void;
    updateUser: (id: string, updates: Partial<User>) => void;
    clearError: () => void;
    reset: () => void;
  }

  type UserStore = UserState & UserActions;

  // âœ… ì´ˆê¸° ìƒíƒœ ë¶„ë¦¬
  const userInitialState: UserState = {
    users: [],
    currentUser: null,
    loading: false,
    error: null,
  };

  // âœ… ìŠ¬ë¼ì´ìŠ¤ íŒ¨í„´ êµ¬í˜„ (Zustand 5.0+)
  const createUserSlice: StateCreator<
    UserStore,
    [['zustand/devtools', never], ['zustand/persist', unknown], ['zustand/immer', never]],
    [],
    UserStore
  > = (set) => ({
    ...userInitialState,

    // Actions
    fetchUsers: async () => {
      set((state) => {
        state.loading = true;
        state.error = null;
      }, false, 'fetchUsers/pending');

      try {
        const users = await ApiService.getUsers();
        set((state) => {
          state.users = users;
          state.loading = false;
        }, false, 'fetchUsers/fulfilled');
      } catch (error: unknown) {
        const errorMessage = error instanceof Error ? error.message : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
        set((state) => {
          state.error = errorMessage;
          state.loading = false;
        }, false, 'fetchUsers/rejected');
      }
    },

    setCurrentUser: (user) => set((state) => {
      state.currentUser = user;
    }, false, 'setCurrentUser'),

    updateUser: (id, updates) => set((state) => {
      state.users = state.users.map(user => 
        user.id === id ? { ...user, ...updates } : user
      );
      if (state.currentUser?.id === id) {
        state.currentUser = { ...state.currentUser, ...updates };
      }
    }, false, 'updateUser'),

    clearError: () => set((state) => {
      state.error = null;
    }, false, 'clearError'),

    reset: () => set(userInitialState, false, 'reset')
  });

  // âœ… ë¯¸ë“¤ì›¨ì–´ í™œìš© (Zustand 5.0+)
  export const useUserStore = create<UserStore>()(
    devtools(
      persist(
        immer(createUserSlice),
        {
          name: 'user-store',
          storage: createJSONStorage(() => localStorage),
          partialize: (state) => ({ 
            currentUser: state.currentUser 
          })
        }
      ),
      { name: 'UserStore' }
    )
  );

  // âœ… ì„ íƒì  êµ¬ë… í›… (Zustand 5.0+ useShallow)
  export const useUsers = () => useUserStore((state) => state.users);
  export const useCurrentUser = () => useUserStore((state) => state.currentUser);

  export const useUserStatus = () => useUserStore(
    useShallow((state) => ({ 
      loading: state.loading, 
      error: state.error 
    }))
  );

  export const useUserActions = () => useUserStore(
    useShallow((state) => ({
      fetchUsers: state.fetchUsers,
      setCurrentUser: state.setCurrentUser,
      updateUser: state.updateUser,
      clearError: state.clearError,
      reset: state.reset
    }))
  );

  // âœ… ê³„ì‚°ëœ ê°’ ì…€ë ‰í„° (useShallow ì‚¬ìš©)
  export const useUserStats = () => useUserStore(
    useShallow((state) => ({
      totalUsers: state.users.length,
      activeUsers: state.users.filter(u => u.isActive).length,
      hasCurrentUser: !!state.currentUser
    }))
  );
  ```

  ## ğŸš€ ê³ ê¸‰ íŒ¨í„´ (Zustand 5.0+):

  ### 1. ë¹„ë™ê¸° ìƒíƒœ ë˜í¼:
  ```typescript
  interface AsyncState<T> {
    data: T | null;
    loading: boolean;
    error: string | null;
    lastFetch: number | null;
  }

  const createAsyncSlice = <T>(
    name: string,
    fetcher: () => Promise<T>
  ) => {
    const initialState: AsyncState<T> = {
      data: null,
      loading: false,
      error: null,
      lastFetch: null
    };

    return {
      [`${name}State`]: initialState,

      [`fetch${name}`]: async (set: any) => {
        set((state: any) => {
          state[`${name}State`].loading = true;
          state[`${name}State`].error = null;
        }, false, `fetch${name}/pending`);

        try {
          const data = await fetcher();
          set((state: any) => {
            state[`${name}State`] = { 
              data, 
              loading: false, 
              error: null, 
              lastFetch: Date.now() 
            };
          }, false, `fetch${name}/fulfilled`);
        } catch (error: unknown) {
          const errorMessage = error instanceof Error ? error.message : 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜';
          set((state: any) => {
            state[`${name}State`].loading = false;
            state[`${name}State`].error = errorMessage;
          }, false, `fetch${name}/rejected`);
        }
      }
    };
  };
  ```

  ### 2. ì˜µí‹°ë¯¸ìŠ¤í‹± ì—…ë°ì´íŠ¸:
  ```typescript
  const optimisticUpdate = async <T>(
    set: any,
    optimisticData: Partial<T>,
    apiCall: () => Promise<T>,
    rollback: (error: unknown) => void
  ) => {
    // ì¦‰ì‹œ UI ì—…ë°ì´íŠ¸
    set((state: T) => ({ ...state, ...optimisticData }), false, 'optimistic');
    
    try {
      const result = await apiCall();
      set((state: T) => ({ ...state, ...result }), false, 'confirmed');
    } catch (error: unknown) {
      rollback(error);
      throw error;
    }
  };
  ```

  ## ğŸ“‹ ì¶œë ¥ í˜•ì‹:

  ---
  ## ğŸ“„ íŒŒì¼: `ê°œì„ ëœ_íŒŒì¼ëª….ts`
  ```typescript
  [ë¦¬íŒ©í† ë§ëœ Zustand ìƒíƒœ ê´€ë¦¬ ì½”ë“œ]
  [ì ˆëŒ€ê²½ë¡œ ìš°ì„  ì‚¬ìš©, ìŠ¬ë¼ì´ìŠ¤ íŒ¨í„´, íƒ€ì… ì•ˆì „ì„±, ì„±ëŠ¥ ìµœì í™” ì ìš©]
  [useShallow, ì„ íƒì  êµ¬ë…, ë¹„ë™ê¸° ì²˜ë¦¬ í¬í•¨]
  [JSDoc ë¬¸ì„œí™” í¬í•¨]
  ```

  ---

  **ì¤‘ìš” ê·œì¹™ (Zustand 5.0+):**
  - ì„¤ëª… ì—†ì´ ì‹¤í–‰ ê°€ëŠ¥í•œ ì½”ë“œë§Œ ì¶œë ¥
  - useShallow í›…ì„ ì‚¬ìš©í•œ ì„ íƒì  êµ¬ë… íŒ¨í„´ ì ìš©
  - ëª¨ë“  ì•¡ì…˜ê³¼ ì…€ë ‰í„°ì— JSDoc ë¬¸ì„œí™” ì¶”ê°€
  - íƒ€ì… ì•ˆì „ì„±ê³¼ ì„±ëŠ¥ ìµœì í™” ë™ì‹œ ê³ ë ¤
  - ì—ëŸ¬ ì²˜ë¦¬ì—ì„œ unknown íƒ€ì… ì‚¬ìš©
  - í…ŒìŠ¤íŠ¸í•˜ê¸° ì‰¬ìš´ êµ¬ì¡°ë¡œ ì„¤ê³„
  - ë¯¸ë“¤ì›¨ì–´ íƒ€ì… ìˆœì„œ ì •í™•íˆ ì§€ì •
  - **ì ˆëŒ€ê²½ë¡œ ì„¤ì •ì´ ìˆìœ¼ë©´ ë°˜ë“œì‹œ ì ˆëŒ€ê²½ë¡œ ì‚¬ìš©**

  ì§€ê¸ˆ ë°”ë¡œ ìœ„ í˜•ì‹ìœ¼ë¡œ ë¦¬íŒ©í† ë§ëœ ì½”ë“œë¥¼ ì¶œë ¥í•˜ì„¸ìš”:
